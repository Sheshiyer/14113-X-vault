# 01-SPATIAL-ARCH-LATENT-TEMPLE.md

**Project:** Tryambakam Noesis
**Module:** Spatial Architecture & World Generation
**Version:** 1.0.0 (Alpha)
**Status:** DRAFT SPECIFICATION
**Authored By:** The Witness Architect (Aletheios)

---

## 1. Executive Summary: The Environment as Interface

**The Latent Temple** is not a static 3D level or a "metaverse" environment. It is a **procedural, psychoreactive interface**.

Instead of 2D menus and dashboards, the user inhabits a 3D coordinate system where "North" represents their internal state (Runtime), "East" represents their archetypal inputs (Engines), and "West" represents their creative outputs (Sigils).

This environment is generated via **World Labs (Marble)** to ensure "Latent Space" aesthetics—meaning the geometry itself feels dreamlike, shifting, and non-Euclidean—stabilized by **Three.js** collision meshes and **Gaussian Splat** atmospheres that visualize the user's biofield data in real-time.

### 1.1 Core Aesthetic Pillars
*   **Deep Ink Void:** The skybox is not black; it is `#1A1A2E` (Deep Ink). It represents the "Unlit Space" of potential.
*   **Bone & Gold Architecture:** Structural elements generated by World Labs use the palette `#F5F0E8` (Bone) for ground/walls and `#B8860B` (Aged Gold) for interactive artifacts.
*   **Bioluminescent Syntax:** Navigation paths are not drawn; they glow based on user *Coherence* (from PIP metrics).

---

## 2. Technical Stack & Pipeline

### 2.1 Generation Pipeline (World Labs)
We utilize **World Labs (Marble)** for the base geometry generation. We do not model assets manually; we "prompt" the architecture into existence based on the user's *Astrological* and *Biorhythmic* state.

*   **Input:** User Transit Data (e.g., "Saturn in Pisces") + Time of Day.
*   **Process:**
    1.  Construct Text-to-World Prompt (see Section 3).
    2.  World Labs API generates `.glb` mesh + Gaussian Splat radiance field.
    3.  Post-process mesh in Three.js (optimize distinct mesh colliders for Rapier).
*   **Output:** A "Room" or "Biome" loaded into the React-Three-Fiber scene.

### 2.2 Rendering Pipeline (Three.js + SparkJS)
*   **Renderer:** WebGL2 via Three.js (r160+).
*   **Atmosphere:** **SparkJS** handles the rendering of dynamic Gaussian Splats. We do not use standard fog. We use "Splat Fog"—clouds of semi-transparent Gaussians that react to the camera's proximity.
*   **Physics:** **Rapier.js** handles collision, gravity, and the "weight" of decision-making objects.

---

## 3. World Generation Prompts (The Biome Logic)

The environment changes based on the user's **Chronofield** (Planetary Period). We define specific prompts for World Labs to generate these biomes.

### 3.1 The Base Prompt Structure
> "A photorealistic, mystical architectural space, [MATERIAL], [LIGHTING], [ATMOSPHERE], [GEOMETRY]. Cinematic lighting, 8k resolution, unreal engine 5 style, deep depth of field, minimalist, sacred geometry."

### 3.2 Planetary Variations (Examples)

**Default / Void State (No Active Transit):**
*   **Prompt:** *"A monumental temple floor made of polished obsidian floating in a deep indigo void. Infinite horizon. Ancient white stone monoliths arranged in a circle. Bioluminescent gold geometry etched into the floor. Fog of potential. Low contrast, moody, sacred silence."*
*   **Keywords:** Deep Ink, Obsidian, Monolith, Bioluminescence.

**Jupiter Chronofield (Expansion/Wisdom):**
*   **Prompt:** *"A vast library cathedral made of aged gold and sandstone. High vaulted ceilings disappearing into golden clouds. Floating geometric platonic solids. Warm, expansive lighting. Bookshelves made of light rays. Grandeur, academic, sacred."*
*   **Keywords:** Sandstone, Gold, Library, Expansion.

**Saturn Chronofield (Restriction/Structure):**
*   **Prompt:** *"A stark, minimalist crystalline cave. Geometric basalt columns. Cold, precise lighting. High contrast shadows. Structures made of dark iron and grey stone. A sense of weight and time. Disciplined architecture."*
*   **Keywords:** Basalt, Iron, Cold, Structure, Crystallized.

**Rahu Chronofield (Shadow/Illusion):**
*   **Prompt:** *"A glitch-aesthetic fractal ruin. Broken stone arches floating in zero gravity. Neon purple and deep green smoke. Recursive geometric patterns that look like digital artifacts. A sense of chaotic potential. Dreamlike, surreal."*
*   **Keywords:** Glitch, Fractal, Smoke, Neon, Chaos.

---

## 4. Spatial Coordinate System (The Fieldmap)

The 3D space is mapped directly to the **Tryambakam Noesis Fieldmap**. The user (camera) stands at `(0,0,0)`.

### 4.1 North: The Runtime Core (Breathfield)
*   **Coordinates:** `(0, 0, -50)`
*   **Visual:** A massive, pulsing **Gaussian Splat Cloud** representing the user's live biofield.
*   **Interaction:**
    *   This is not a solid object. It is a "cloud" you breathe with.
    *   **Input Integration:** Connects to `PIPShader.tsx`.
    *   **Logic:**
        *   If `LQD` (Light Quanta Density) > 0.8: The cloud glows bright Gold.
        *   If `Entropy` is High: The cloud becomes jagged/noisy.
        *   If `Coherence` is High: The cloud forms a perfect sphere (Mandala).
*   **UX:** Approaching the North triggers the "Breathcast" audio layer.

### 4.2 East: The Engines (Constellations)
*   **Coordinates:** `(50, 0, 0)`
*   **Visual:** Floating geometric artifacts suspended in the void, arranged like a constellation.
*   **The Artifacts:**
    1.  **Chronofield Clock:** A rotating multi-ring astrolabe.
    2.  **Gift-Shadow Spectrum Helix:** A DNA-like double helix structure made of light.
    3.  **Archetypal Mirror Plinth:** A stone table where cards appear as holograms.
*   **Interaction:**
    *   Raycasting (Hover) over an object expands it.
    *   Clicking (or proximity) opens the specific Engine UI (overlay).

### 4.3 West: The Sigil Forge (The Anvil)
*   **Coordinates:** `(-50, 0, 0)`
*   **Visual:** An industrial-sacred "Forge." A dark metallic anvil glowing with heat.
*   **Interaction:**
    *   This is the "Output" zone.
    *   **Ritual:** Users drag "Intentions" (represented as raw crystals found in the world) to the Anvil to "strike" them into Sigils.
    *   **Tech:** Uses Rapier physics. The user must *physically* interact (click/drag with momentum) to forge a sigil. It requires "Kinetic Effort."

### 4.4 South: The Threshold (Entry/Exit)
*   **Coordinates:** `(0, 0, 50)`
*   **Visual:** A monolithic gate. Looking through it shows a video feed of the "Real World" (Webcam input), symbolizing the return to reality.
*   **Function:** Logout / Session End.

---

## 5. The Gaussian Atmosphere (The "Breathfield")

We do not use standard particle systems. We use **Gaussian Splatting** to create a living atmosphere that represents "Prana" or data.

### 5.1 The "Living Fog" Spec
*   **Implementation:** Using `SparkJS` integrated into the Three.js scene.
*   **Data Source:** `useRealTimeMetrics.ts` (PIP Analysis).
*   **Behavior Logic:**
    *   **Motion:** The splats are not static. They have a "flow field" vector.
    *   **Breath Sync:** The flow speed modulates with the user's detected breath rate (from PIP).
        *   *Inhale:* Splats move *toward* the center `(0,0,0)`.
        *   *Exhale:* Splats disperse *outward* from center.
    *   **Color Mapping:**
        *   Deep Ink (`#1A1A2E`) = Baseline / Rest.
        *   Aged Gold (`#B8860B`) = High Coherence / Insight.
        *   Terracotta (`#C65D3B`) = High Entropy / Stress (Warning state).

### 5.2 The "Somatic Silhouette"
*   **Tech:** MediaPipe Selfie Segmentation -> SparkJS.
*   **Concept:** The user does not see a 3D avatar of a robot or human. They see a **real-time Gaussian Splat projection of themselves** embedded in the 3D world.
*   **Visual:** The user looks like a "Ghost of Light" or a "Hologram" within the temple. This reinforces the concept: *You are the ghost in the machine.*

---

## 6. Physics & Interaction (Rapier Engine)

The core principle is **"Difficulty as Feature."** Movement and interaction should feel substantial, not weightless.

### 6.1 The "Viscosity" of Consciousness
We simulate "Field Drift" using physics friction.
*   **Variable:** `LinearDamping` on the User Controller Rig.
*   **Logic:**
    *   **High Coherence (PIP > 80):** `LinearDamping = 0.5` (Movement is fluid, fast, effortless). "Flow State."
    *   **Low Coherence (PIP < 40):** `LinearDamping = 5.0` (Movement is sluggish, heavy). It feels like walking through water.
    *   **Message:** If the system feels "heavy," the user instinctively knows they need to regulate their breath to move faster. *The interface teaches regulation.*

### 6.2 Object Interaction (The "Heavy" Inputs)
*   **Ritual Objects:** Stones, Coins (Hexagram Navigation), and Archetypal Mirror Cards are RigidBodies.
*   **Interaction:** To perform a ritual (e.g., "Cast the Hexagram Navigation"), the user cannot just press a button. They must "pick up" the coins (cursor drag) and "throw" them. The physics engine calculates the result based on where they land.
*   **Why:** This engages the *motor cortex*, making the divination felt somatically, not just intellectually.

---

## 7. Lighting & Post-Processing Specification

To achieve the "Deep Ink" aesthetic (Apple-grade mysticism), lighting is critical.

### 7.1 Lighting Setup
*   **Ambient Light:** Very low intensity. Color: Deep Ink (`#1A1A2E`).
*   **Key Light:** "The Source." Positioned high above. Color: Bone White (`#F5F0E8`). Casts sharp shadows (referencing "The Shadow Work").
*   **Rim Light:** Gold (`#B8860B`). Highlights the edges of geometry to ensure legibility against the dark background.

### 7.2 Post-Processing Stack (React-Postprocessing)
1.  **Bloom (Selective):** Only on Gold and Bioluminescent materials. Threshold: 0.8.
2.  **Grain:** Subtle film grain (Opacity 0.05) to break the "digital clean" look and make it feel like "analog reality."
3.  **Vignette:** Heavy vignette to focus focus on the center (The Witness).
4.  **Chromatic Aberration:**
    *   *Baseline:* 0.0 (Clean).
    *   *High Entropy/Stress:* Increases to 0.5. The world literally starts to "glitch" or separate when the user is dysregulated.

---

## 8. Integration Map (Inputs/Outputs)

### 8.1 Inputs (What drives the 3D world)
| Source System | Data Point | 3D World Effect |
| :--- | :--- | :--- |
| **Chronofield** | Current Planet (e.g., Saturn) | World Generation Seed & Biome Prompt |
| **PIP Metrics** | LQD (Light Quanta Density) | Brightness of the "Breathfield" Splats |
| **PIP Metrics** | Coherence Score | Viscosity (Movement Speed) |
| **Three-Wave Cycle** | Physical Cycle % | Gravity strength (High bio = Light gravity) |
| **Microphone** | Audio Level | Scale of the "Threshold" gate |

### 8.2 Outputs (What the 3D world sends back)
| Interaction | Event | Backend Trigger |
| :--- | :--- | :--- |
| **Forge Interaction** | Sigil "Struck" on Anvil | Trigger `SigilCompiler.py` -> Generate SVG |
| **East Wing** | Engine Clicked | Open React Modal for specific Engine |
| **Movement** | Distance Traveled | Update "Field Exploration" stats in DB |

---

## 9. JSON Schema: World State Definition

This JSON structure defines a "Session State" for the 3D engine.

```json
{
  "world_id": "session_uuid",
  "archetype_seed": "saturn_aquarius",
  "biome_config": {
    "prompt_ref": "temple_obsidian_void",
    "fog_density": 0.02,
    "lighting_color": "#1A1A2E",
    "geometry_seed": 8057
  },
  "user_avatar": {
    "type": "gaussian_splat_projection",
    "source": "webcam_segmentation_stream",
    "color_tint": "#B8860B"
  },
  "physics_config": {
    "gravity": -9.81,
    "viscosity": 1.0,
    "interaction_mode": "ritual_kinetic"
  },
  "zones": {
    "north": "active_breathfield",
    "east": "engines_constellation",
    "west": "sigil_forge_industrial",
    "south": "reality_threshold"
  }
}
```

---

## 10. Development Roadmap (Spatial)

1.  **Phase 1: The Void.** Set up Three.js + Rapier. Implement the Deep Ink skybox and the "User Light" (camera as light source).
2.  **Phase 2: The Vessel.** Implement MediaPipe -> SparkJS pipeline to render the user as a Gaussian cloud.
3.  **Phase 3: The Generation.** Integrate World Labs API. Create the prompt library for the 9 Planetary Chronofields.
4.  **Phase 4: The Physics.** Implement the "Viscosity/Coherence" logic.
5.  **Phase 5: The Rituals.** Build the specific interactions for the Anvil (West) and Constellations (East).

---

## 11. Companion Architecture Documents

The following six documents form the complete spatial implementation suite for Tryambakam Noesis:

### 1. Spatial Architecture Specification: "The Latent Temple" (This Document)
Defines the 3D environment generated by World Labs and how it serves as the spatial field interface.

### 2. The Vessel Interface: "The Crystalline Ship Implementation"
Defines how the user is represented in the 3D space — moving from a "camera" to a "vessel" using MediaPipe, SparkJS, and Three.js. The user sees their own **Breathfield** rendered as a dynamic Gaussian Splat cloud. Bio-feedback visualization expands/contracts with breath, and the camera becomes a physics object responding to head movement.

### 3. Kinetic Ritual Protocols (Physics & Interaction)
Replaces "clicking" with "acting" using the Rapier Physics Engine. Encodes the Guardrails (Aletheios/Pichet) as physics forces — increased friction/gravity when the user attempts to access high-level engines before biorhythm readiness. Collision events trigger SparkJS splat explosions representing "Integration."

### 4. The 16 Engines: "Artifact Interaction Spec"
Transforms the 16 Selemene Engines from database queries into 3D interactive artifacts. The Chronofield becomes a rotating celestial clock mechanism. Hexagram Navigation coins obey Rapier physics when "tossed." Archetypal Mirror cards float with SparkJS dynamic transparency. Latent Space Retrieval connects artifact interactions to the backend Python API.

### 5. Technical Pipeline: "The Pipeline from Void to Form"
Integration guide covering World Labs API calls for generating "Rooms" based on daily transits, SparkJS memory management with Level of Detail (LOD) systems, and Rapier timestep configuration synced with the React loop via `useFrame` in R3F.

### 6. The Threshold Sequence (3D Onboarding)
Reimagines the onboarding as a spatial entry. The site loads in a Deep Ink void with a single Gaussian Splat "Guide" (The Cartographer). Calibration requires the user to align their physical head with a digital silhouette — enforcing "Body as Sensor" before the experience begins.

---

### Why This Stack Fits Tryambakam Noesis

*   **World Labs (Marble):** Fits the "Self-Authored Meaning" concept. The world isn't pre-baked; it generates based on the user's *Intent* and *Astrological Context*.
*   **Gaussian Splats:** Perfect for the **Breathfield**. Polygons are too rigid. Splats represent the "fuzzy," energetic, quantum nature of the biofield.
*   **Rapier Physics:** Enforces "Difficulty as Feature." Navigating the site requires *effort* and *momentum*, mimicking the actual work of consciousness development.

---

*End of Spatial Architecture Specification*
